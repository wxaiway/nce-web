<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#0a84ff" />
    <title>NCE - 课文</title>
    <link rel="stylesheet" href="/css/styles.css" />
  </head>
  <body>
    <!-- 页面头部 -->
    <header class="hero">
      <h1 id="lessonTitle">课文</h1>
      <p id="lessonSub"></p>

      <!-- 导航区域：返回按钮 + Tab 切换 -->
      <div class="lesson-header">
        <a id="backLink" class="back-link">← 返回</a>
        <div class="lesson-tabs">
          <button class="tab-btn active" data-tab="text">课文</button>
          <button class="tab-btn" data-tab="notes">讲解</button>
        </div>
      </div>
    </header>

    <!-- 工具栏 -->
    <div class="toolbar">
      <div class="player-controls">
        <audio id="player" controls></audio>

        <!-- 语言切换（PC端） -->
        <div class="segmented tabs language-switcher" id="languageSwitcher">
          <button data-mode="en">EN</button>
          <button data-mode="bi" class="active">EN+CN</button>
          <button data-mode="cn">CN</button>
        </div>

        <button id="helpBtn" class="control-btn">⌨️</button>
        <span id="wakeLockIcon" class="control-btn" hidden title="屏幕保持常亮中">🔆</span>
        <button id="settingsBtn" class="control-btn">⚙️</button>
      </div>

      <!-- 移动端扩展控制栏 -->
      <div class="mobile-controls" id="mobileControls">
        <select class="mobile-btn language-select" id="mobileLanguageSelect">
          <option value="en">EN</option>
          <option value="bi" selected>EN+CN</option>
          <option value="cn">CN</option>
        </select>
        <button class="mobile-btn" id="seekBackBtn">⏪ -5s</button>
        <button class="mobile-btn" id="seekForwardBtn">⏩ +5s</button>
        <button class="mobile-btn" id="muteBtn">🔇 静音</button>
      </div>
    </div>

    <!-- 加载提示 -->
    <div id="loadingIndicator" class="loading-indicator" hidden>
      <div class="spinner"></div>
      <p>加载中...</p>
    </div>

    <!-- 内容区域 -->
    <main id="content">
      <!-- 课文 Tab -->
      <div id="tab-text" class="tab-content active">
        <div class="sentences" id="sentences"></div>
      </div>

      <!-- 讲解 Tab -->
      <div id="tab-notes" class="tab-content">
        <div class="markdown-content" id="notesContent"></div>
      </div>
    </main>

    <!-- 课程导航 -->
    <nav class="lesson-nav">
      <a id="prevLesson" class="btn-nav prev" href="#" hidden>← 上一课</a>
      <a id="nextLesson" class="btn-nav next" href="#" hidden>下一课 →</a>
    </nav>

    <!-- 设置面板 -->
    <div id="settingsOverlay" class="overlay" hidden></div>
    <div id="settingsPanel" class="settings-panel" hidden>
      <div class="panel-header">
        <h2>设置</h2>
        <button id="settingsClose" class="close-btn">✕</button>
      </div>

      <div class="panel-content">
        <div class="setting-item">
          <label>播放速度</label>
          <div class="setting-desc">调整音频播放速度，适应不同学习节奏。</div>
          <div class="segmented">
            <button data-speed="0.75">0.75x</button>
            <button data-speed="1.0" class="active">1.0x</button>
            <button data-speed="1.25">1.25x</button>
            <button data-speed="1.5">1.5x</button>
            <button data-speed="2.0">2.0x</button>
          </div>
        </div>

        <div class="setting-item">
          <label>学习方式</label>
          <div class="setting-desc">选择适合你的学习场景</div>

          <div class="play-mode-list">
            <label class="mode-option">
              <div class="mode-header">
                <span class="mode-icon">📖</span>
                <span class="mode-title">点读模式</span>
                <input type="radio" name="playMode" value="single" />
              </div>
              <div class="mode-desc">点击句子播放，适合精读</div>
            </label>

            <label class="mode-option">
              <div class="mode-header">
                <span class="mode-icon">🔁</span>
                <span class="mode-title">发音练习</span>
                <input type="radio" name="playMode" value="single-loop" />
              </div>
              <div class="mode-desc">重复播放当前句，适合跟读</div>
            </label>

            <label class="mode-option recommended">
              <div class="mode-header">
                <span class="mode-icon">📚</span>
                <span class="mode-title">
                  标准学习
                  <span class="badge">推荐</span>
                </span>
                <input type="radio" name="playMode" value="continuous" checked />
              </div>
              <div class="mode-desc">自动播放整课，播完停止</div>
            </label>

            <label class="mode-option">
              <div class="mode-header">
                <span class="mode-icon">🔄</span>
                <span class="mode-title">课程复习</span>
                <input type="radio" name="playMode" value="continuous-loop" />
              </div>
              <div class="mode-desc">重复播放当前课，巩固记忆</div>
            </label>

            <label class="mode-option">
              <div class="mode-header">
                <span class="mode-icon">⏭️</span>
                <span class="mode-title">连贯学习</span>
                <input type="radio" name="playMode" value="continuous-next" />
              </div>
              <div class="mode-desc">自动播放下一课，系统学习</div>
            </label>
          </div>
        </div>

        <div class="setting-item">
          <label>
            <input type="checkbox" id="autoScrollToggle" checked />
            自动跟随滚动
          </label>
          <div class="setting-desc">播放时自动滚动到当前句子，保持在视野中心。</div>
        </div>

        <div class="setting-item" id="keepScreenOnSetting" hidden>
          <label>
            <input type="checkbox" id="keepScreenOnToggle" checked />
            播放时保持屏幕常亮（仅手机端）
          </label>
          <div class="setting-desc">防止播放时屏幕自动熄灭，需要浏览器支持。不支持的设备会显示设置提示。</div>
        </div>

        <div class="setting-item" style="margin-top: var(--space-xl); padding-top: var(--space-lg); border-top: 1px solid var(--border);">
          <button id="resetSettingsBtn" class="control-btn" style="width: 100%;">恢复默认设置</button>
        </div>

        <div class="setting-item" style="margin-top: var(--space-md);">
          <div style="margin-bottom: var(--space-sm); font-weight: 500; color: var(--text-secondary);">故障排除</div>
          <button id="resetPlayerBtn" class="control-btn" style="width: 100%; background: var(--warning); color: white;">重置播放器</button>
          <div class="setting-desc">如果遇到播放异常、滚动错误等问题，可以尝试重置播放器。不会影响学习进度和设置。</div>
        </div>
      </div>
    </div>

    <!-- 快捷键帮助面板 -->
    <div id="helpOverlay" class="overlay" hidden></div>
    <div id="helpPanel" class="help-panel" hidden>
      <div class="panel-header">
        <h2>快捷键</h2>
        <button id="helpClose" class="close-btn">✕</button>
      </div>

      <div class="panel-content">
        <div class="shortcuts-grid">
          <div class="shortcut-item">
            <kbd>Space</kbd>
            <span>播放/暂停</span>
          </div>
          <div class="shortcut-item">
            <kbd>R</kbd>
            <span>重播当前句</span>
          </div>
          <div class="shortcut-item">
            <kbd>M</kbd>
            <span>静音/取消静音</span>
          </div>
          <div class="shortcut-item">
            <kbd>←</kbd> / <kbd>A</kbd>
            <span>上一句</span>
          </div>
          <div class="shortcut-item">
            <kbd>→</kbd> / <kbd>D</kbd>
            <span>下一句</span>
          </div>
          <div class="shortcut-item">
            <kbd>↑</kbd>
            <span>音量增加</span>
          </div>
          <div class="shortcut-item">
            <kbd>↓</kbd>
            <span>音量减少</span>
          </div>
          <div class="shortcut-item">
            <kbd>Shift</kbd> + <kbd>←</kbd>
            <span>快退 5 秒</span>
          </div>
          <div class="shortcut-item">
            <kbd>Shift</kbd> + <kbd>→</kbd>
            <span>快进 5 秒</span>
          </div>
          <div class="shortcut-item">
            <kbd>1</kbd> - <kbd>9</kbd>
            <span>跳转到 10%-90%</span>
          </div>
          <div class="shortcut-item">
            <kbd>?</kbd> / <kbd>H</kbd>
            <span>显示此帮助</span>
          </div>
          <div class="shortcut-item">
            <kbd>ESC</kbd>
            <span>关闭面板</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 页脚 -->
    <footer class="site-footer">
      <div class="footer-content">
        <p class="footer-title">New Concept English</p>
        <p class="footer-desc">新概念英语在线学习平台</p>
        <p class="footer-copyright">
          © 2025 NCE. All rights reserved.
          <a href="https://github.com/wxaiway/nce-web" target="_blank" rel="noopener noreferrer" class="footer-icon-link" title="GitHub 仓库">
            <svg class="footer-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
            </svg>
          </a>
        </p>
      </div>
    </footer>

    <!-- 脚本 -->
    <script type="module" src="/js/app.js"></script>
    <script type="module" src="/js/lesson.js"></script>
  </body>
</html>
